<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clube do Ukulele - Envio Laranja</title>

  <style>
    /* --- Estilo Dark Mode Contrastado --- */
    body {
      font-family: 'Roboto', 'Segoe UI', sans-serif;
      background-color: #000000; /* Preto Absoluto */
      color: #FFFFFF;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background: #1a1a1a; /* Cinza bem escuro */
      padding: 40px;
      border-radius: 16px;
      width: 90%;
      max-width: 500px;
      border: 1px solid #333;
      box-shadow: 0 0 50px rgba(255, 109, 0, 0.1); /* Brilho Laranja sutil */
      text-align: center;
    }

    h2 {
      color: #FFFFFF;
      margin-top: 0;
      margin-bottom: 15px;
      font-weight: 600;
    }

    p {
      color: #CCCCCC;
      margin-bottom: 30px;
      font-size: 1rem;
    }

    /* --- A ÁREA DE CLIQUE (Mudou de DIV para LABEL) --- */
    #dropzone {
      display: block; /* Importante para funcionar como caixa */
      border: 2px dashed #FF6D00; /* LARANJA DESTAQUE */
      border-radius: 12px;
      padding: 60px 20px;
      cursor: pointer;
      background-color: #111;
      color: #FF6D00; /* Texto Laranja */
      transition: all 0.2s ease;
      margin-bottom: 20px;
    }

    #dropzone strong {
      font-size: 1.2rem;
      display: block;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    #dropzone span {
      color: #999; /* Cor secundária */
      font-size: 0.9rem;
    }

    #dropzone:hover {
      background-color: #251000; /* Fundo laranja bem escuro no hover */
      border-color: #FF9100;
      transform: scale(1.01);
    }

    /* Quando desativado (durante upload) */
    #dropzone.disabled {
      pointer-events: none; /* Trava clique */
      opacity: 0.4;
      border-color: #555;
      filter: grayscale(100%);
    }

    /* Esconde o input original mas mantendo acessibilidade */
    .visually-hidden {
      position: absolute !important;
      height: 1px;
      width: 1px;
      overflow: hidden;
      clip: rect(1px, 1px, 1px, 1px);
      white-space: nowrap;
      opacity: 0; 
    }

    .hidden {
      display: none;
    }

    /* Barra de Progresso */
    .progress-wrapper {
      margin-top: 20px;
      text-align: left;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
      color: #FF6D00; /* Laranja */
      font-weight: bold;
    }

    progress {
      width: 100%;
      height: 10px;
      border-radius: 5px;
      overflow: hidden;
      background-color: #333;
      appearance: none;
      border: none;
    }
    
    progress::-webkit-progress-bar {
      background-color: #333;
      border-radius: 5px;
    }

    progress::-webkit-progress-value {
      background-color: #FF6D00; /* Barra Laranja */
      border-radius: 5px;
      transition: width 0.3s ease;
    }

    /* Mensagens */
    #success {
      background-color: #0a1a0a; 
      color: #4caf50;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #4caf50;
      margin-top: 20px;
    }

    #error {
      background-color: #1a0a0a;
      color: #ff5252;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #ff5252;
      margin-top: 20px;
      word-break: break-word;
    }

    /* Botão Reiniciar */
    .btn-reset {
      margin-top: 15px;
      background-color: #FF6D00;
      color: #000;
      border: none;
      padding: 12px 30px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: 800;
      font-size: 14px;
      text-transform: uppercase;
      transition: background 0.2s;
    }

    .btn-reset:hover {
      background-color: #FF9100;
      box-shadow: 0 0 15px rgba(255, 109, 0, 0.4);
    }
  </style>

  <!-- Biblioteca TUS -->
  <script src="https://cdn.jsdelivr.net/npm/tus-js-client@2.3.0/dist/tus.min.js"></script>
</head>

<body>
  <div class="container">

    <h2>Enviar Vídeo</h2>
    <p>Selecione seu arquivo abaixo.</p>

    <!-- A MÁGICA: Usar LABEL em vez de DIV faz o clique funcionar nativamente -->
    <label id="dropzone" for="fileInput">
      <strong>Clique para Selecionar</strong>
      <span>ou arraste o arquivo aqui</span>
    </label>

    <!-- Input escondido ligado ao Label acima -->
    <input id="fileInput" type="file" accept="video/*" class="visually-hidden" />

    <div class="progress-wrapper hidden" id="progressContainer">
      <div class="progress-info">
        <span>Carregando...</span>
        <span id="percentageText">0%</span>
      </div>
      <progress id="progressBar" value="0" max="100"></progress>
    </div>

    <div id="success" class="hidden">
      <div style="font-size: 2rem; margin-bottom: 10px;">✅</div>
      <strong>Upload Concluído!</strong><br>
      <button class="btn-reset" onclick="resetUpload()">Enviar Outro</button>
    </div>

    <div id="error" class="hidden"></div>

  </div>

  <script>
    // --- CONFIGURAÇÃO ---
    const TUS_ENDPOINT = "https://tus-upload-server-1019908552664.southamerica-east1.run.app/files/";

    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("fileInput");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const percentageText = document.getElementById("percentageText");
    const successMsg = document.getElementById("success");
    const errorMsg = document.getElementById("error");

    // --- EVENTOS DRAG & DROP (Visual apenas, pois o Label cuida do clique) ---

    dropzone.addEventListener("dragover", (e) => {
      e.preventDefault();
      if (!dropzone.classList.contains("disabled")) {
        dropzone.style.backgroundColor = "#251000";
        dropzone.style.borderColor = "#FF9100";
      }
    });

    dropzone.addEventListener("dragleave", () => {
      if (!dropzone.classList.contains("disabled")) {
        dropzone.style.backgroundColor = "#111";
        dropzone.style.borderColor = "#FF6D00";
      }
    });

    dropzone.addEventListener("drop", (e) => {
      e.preventDefault(); // Impede o navegador de abrir o arquivo na aba
      
      // Reseta visual
      dropzone.style.backgroundColor = "#111";
      dropzone.style.borderColor = "#FF6D00";
      
      if (dropzone.classList.contains("disabled")) return;

      // Pega o arquivo arrastado
      const file = e.dataTransfer.files[0];
      if (file) startUpload(file);
    });

    // Detecta quando o usuário escolheu o arquivo pelo clique normal
    fileInput.addEventListener("change", () => {
      const file = fileInput.files[0];
      if (file) startUpload(file);
    });

    // --- FUNÇÃO DE UPLOAD ---

    function startUpload(file) {
      resetUI(true);
      
      const upload = new tus.Upload(file, {
        endpoint: TUS_ENDPOINT,
        chunkSize: 10485760, // 10MB
        retryDelays: [0, 1000, 3000, 5000],
        metadata: {
          filename: file.name,
          filetype: file.type
        },

        onError: function(error) {
          console.error("Erro:", error);
          errorMsg.innerHTML = "❌ <strong>Erro:</strong><br>" + error + 
                               "<br><br><button class='btn-reset' onclick='resetUpload()'>Tentar Novamente</button>";
          errorMsg.classList.remove("hidden");
          // Reabilita o dropzone em caso de erro
          dropzone.classList.remove("disabled");
        },

        onProgress: function(bytesUploaded, bytesTotal) {
          const percentage = ((bytesUploaded / bytesTotal) * 100).toFixed(0);
          progressBar.value = percentage;
          percentageText.textContent = percentage + "%";
        },

        onSuccess: function() {
          console.log("Sucesso:", upload.url);
          progressContainer.classList.add("hidden");
          successMsg.classList.remove("hidden");
        }
      });

      upload.start();
    }

    // --- CONTROLE VISUAL ---

    function resetUI(isUploading) {
      if (isUploading) {
        successMsg.classList.add("hidden");
        errorMsg.classList.add("hidden");
        progressContainer.classList.remove("hidden");
        
        // Trava o label visualmente
        dropzone.classList.add("disabled");
        dropzone.innerHTML = "<strong>Enviando...</strong><span>Por favor, aguarde.</span>";
        
        progressBar.value = 0;
        percentageText.textContent = "0%";
      }
    }

    function resetUpload() {
      fileInput.value = "";
      successMsg.classList.add("hidden");
      errorMsg.classList.add("hidden");
      progressContainer.classList.add("hidden");
      
      dropzone.classList.remove("disabled");
      dropzone.innerHTML = "<strong>Clique para Selecionar</strong><span>ou arraste o arquivo aqui</span>";
    }
  </script>
</body>
</html>
